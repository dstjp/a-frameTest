<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
		<!-- <script src="https://unpkg.com/@c-frame/aframe-physics-system@4.2.2/dist/aframe-physics-system.min.js"></script> -->
	</head>
	<body>
		<a-scene>
			<a-sky color="black"></a-sky>
			<a-entity id="stars"></a-entity>
			<a-entity
				id="cameraRig"
				position="0 5 40"
				camera
				look-controls
				wasd-controls
				vertical-controls
			>
			</a-entity>

			<a-entity id="cube-group" position="0 0 -3" smooth-rotation>
				<a-box
					id="red-cube"
					color="red"
					position="-10 0 0"
					height="10"
					width="10"
					depth="10"
				>
				</a-box>
				<a-box color="green" position="0 0 0" height="10" width="10" depth="10">
				</a-box>
				<a-box color="blue" position="10 0 0" height="10" width="10" depth="10">
				</a-box>
				<a-box
					id="yellow-cube"
					color="yellow"
					position="0 10 0"
					height="10"
					width="10"
					depth="10"
				>
				</a-box>
			</a-entity>
		</a-scene>

		<script>
			AFRAME.registerComponent("cube-controls", {
				init: function () {
					this.cubeGroup = document.querySelector("#cube-group");
					this.redCube = document.querySelector("#red-cube");

					this.isRedCubeMoved = false;

					window.addEventListener("keydown", (e) => {
						if (e.code === "KeyF") {
							this.toggleRedCubePosition();
						}
					});
				},
				toggleRedCubePosition: function () {
					const targetPos = this.isRedCubeMoved ? "-10 0 0" : "-10 10 0";
					this.redCube.setAttribute("animation", {
						property: "position",
						to: this.isRedCubeMoved ? "-10 0 0" : "-10 10 0",
						dur: 500,
						easing: "easeInOutQuad",
					});
				},
			});
			document.querySelector("a-entity").setAttribute("cube-controls", "");

			//Fly Controls Logic
			AFRAME.registerComponent("vertical-controls", {
				schema: {
					speed: { type: "number", default: 5 },
				},
				init: function () {
					this.velocity = 0;
					this.keys = {};

					window.addEventListener("keydown", (e) => {
						this.keys[e.code] = true;
					});

					window.addEventListener("keyup", (e) => {
						this.keys[e.code] = false;
					});
				},
				tick: function (time, deltaTime) {
					const el = this.el;
					const position = el.getAttribute("position");
					const delta = deltaTime / 1000;
					const speed = this.data.speed;

					if (this.keys["Space"]) {
						position.y += speed * delta;
					}

					if (this.keys["KeyC"]) {
						position.y = Math.max(1, position.y - speed * delta);
					}

					el.setAttribute("position", position);
				},
			});

			// Smooth loop logic
			AFRAME.registerComponent("smooth-rotation", {
				schema: {
					speed: { type: "number", default: 36 },
				},
				init: function () {
					this.currentRotation = 0;
				},
				tick: function (time, deltaTime) {
					const el = this.el;
					const delta = deltaTime / 1000;
					const speed = this.data.speed;

					this.currentRotation += speed * delta;

					if (this.currentRotation >= 360) {
						this.currentRotation -= 360;
					}

					el.setAttribute("rotation", `0 ${this.currentRotation} 0`);
				},
			});

			/* Starfield logic */
			AFRAME.registerComponent("starfield", {
				schema: {
					count: { type: "int", default: 100 },
				},
				init: function () {
					for (let i = 0; i < this.data.count; i++) {
						const star = document.createElement("a-sphere");
						const radius = 0.1;
						star.setAttribute("radius", radius);
						star.setAttribute("color", "white");

						const pos = {
							x: (Math.random() - 0.5) * 200,
							y: (Math.random() - 0.5) * 200,
							z: (Math.random() - 0.5) * 200,
						};

						star.setAttribute("position", `${pos.x} ${pos.y} ${pos.z}`);
						this.el.appendChild(star);
					}
				},
			});
			document.querySelector("#stars").setAttribute("starfield", "");
		</script>
	</body>
</html>
